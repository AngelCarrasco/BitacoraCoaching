{% extends 'core/administrador/base.html' %}
{% load static %}
{% block titulo%}
<title>Proceso</title>
{% endblock %}
{%block contenido%}

<br>
<br>
<!-- separar la wea en dos!-->
<div class="container">
  <div class="row">
    <div class="col">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Listado de procesos</h3>
        </div>
        <div class="card-body">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>#</th>
                <th>Proceso</th>
                <th>Modalidad</th>
                <th>Coach</th>
                <th>Empresa</th>
              </tr>
            </thead>
            <tbody>
              {% for i in procesos%}
              <tr>
                <td id="id_proceso">{{i.0}}</td>
                <td>{{i.1}}</td>
                <td>{{i.2}}</td>
                <td>{{i.3}}</td>
                <td>{{i.4}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="card-footer clearfix">
          <ul class="pagination pagination-sm m-0 float-right">
            <li class="page-item">
              <a class="page-link" href="#">«</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#">1</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#">2</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#">3</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#">»</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="container">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Asigna un proceso nuevo</h3>
          </div>
          <form action="" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="card-body">
              <div class="form-group">
                <label for="exampleInputEmail1">Nombre Proceso</label>
                <input class="form-control" type="text" name="nom_proceso" id="nom_proceso" placeholder="Nombre Proceso"
                  required="">
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Modalidad</label>
                <input class="form-control" type="text" name="modalidad" id="modalidad" placeholder="Modalidad"
                  required="">
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Fecha Contrato</label>
                <input class="form-control" data-date-format="d-m-YTH:i" data-time_24hr=true type="date" id="fecha_acordada" placeholder="dd-mm-yyyy" name="fecha_acordada" required="">
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Clausula</label>
                <input class="form-control-file" type="file" name="archivo" id="archivo" required=""
                  onchange="return validarExt()"
                  accept=".xlsx,.pptx,.pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
              </div>
              <div class="form-group">
                <label for="exampleInputFile">Selecciona un Coach</label>
                <select class="form-control" name="coach" id="coach" required="">
                  <option value="">Seleciona</option>
                  {% for i in coachs %}
                  <option value="{{i.0}}">{{i.1}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-group">
                <label for="exampleInputFile">Empresa</label>
                <select class="form-control" name="empresa" id="empresa" required="">
                  <option value="">Seleciona</option>
                  {% for i in empresas %}
                  <option value="{{i.0}}">{{i.1}}</option> 
                  {% endfor %}
                </select>
              </div>
              <div class="card-footer">
                <input class="btn btn-primary" type="submit" value="Agregar">
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>


{% endblock %}

{% block js%}

<!-- ALERTAS -->
{% if messages %}
{% for m in messages %}
{% if m.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
<script>
   Swal.fire(
  'Perfecto',
  '{{m}}',
  'success'
)
</script>
{% endif %}

{% if m.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
<script>
   Swal.fire(
  'Error!!!',
  '{{m}}',
  'warning'
)
</script>
{% endif %}

{% endfor %}
{%endif%}
<!-- FIN ALERTAS -->

<!--Script de la tabla proceso-->
<script>
  var clients = [
    { "Name": "Otto Clay", "Age": 25, "Country": 1, "Address": "Ap #897-1459 Quam Avenue", "Married": false },
    { "Name": "Connor Johnston", "Age": 45, "Country": 2, "Address": "Ap #370-4647 Dis Av.", "Married": true },
    { "Name": "Lacey Hess", "Age": 29, "Country": 3, "Address": "Ap #365-8835 Integer St.", "Married": false },
    { "Name": "Timothy Henson", "Age": 56, "Country": 1, "Address": "911-5143 Luctus Ave", "Married": true }

  ];

  var countries = [
    { Name: "", Id: 0 },
    { Name: "United States", Id: 1 },
    { Name: "Canada", Id: 2 },
    { Name: "United Kingdom", Id: 3 }
  ];

  $("#jsGrid").jsGrid({
    width: "100%",
    height: "100%",

    filtering: true,
    editing: true,
    sorting: true,
    paging: true,
    autoload: true,

    data: clients,

    fields: [
      { name: "Name", type: "text", width: 150, validate: "required" },
      { name: "Age", type: "number", width: 50 },
      { name: "Address", type: "text", width: 200 },
      { name: "Country", type: "select", items: countries, valueField: "Id", textField: "Name" },
      { name: "Married", type: "checkbox", title: "Is Married", sorting: false },
      { type: "control" }
    ]
  });
</script>
<!--Fecha-->
<script>
  config = {    
      minDate: "today",
      locale: { 
      firstDayOfWeek: 1,
      weekdays: {
        shorthand: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'],
        longhand: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],         
      }, 
      months: {
        shorthand: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Оct', 'Nov', 'Dic'],
        longhand: ['Enero', 'Febreo', 'Мarzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
      }
      }}
  flatpickr("#fecha_acordada",config);

</script>

<!--Rescatar la id del proceso y mandarla por URL al detalle-->
<script>
  function detalle(){
    
    //var UserData = {};
    
    
    let id_proceso = document.getElementById("id_proceso").value;
      let url = '/detalle_proceso/?proceso='+id_proceso;
      fetch(url)
      .then(function(result){
        return result.text();
      })
      .then(function(result){
        document.getElementById("detalleProceso").innerHTML = result;
      });    
  };
</script>
{% endblock %}